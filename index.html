<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Operativo Rentia Investments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            securityLevel: 'loose',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#fff',
                primaryBorderColor: '#1e40af',
                lineColor: '#334155',
                secondaryColor: '#eff6ff',
                tertiaryColor: '#fff'
            }
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        
        /* Tipograf√≠a y Estructura */
        .prose h3 { color: #1e3a8a; margin-top: 2.5em; font-weight: 800; font-size: 1.4rem; border-bottom: 3px solid #e2e8f0; padding-bottom: 0.5rem; }
        .prose h4 { color: #2563eb; margin-top: 1.5em; font-weight: 700; font-size: 1.15rem; }
        .prose ul { list-style-type: none; padding-left: 0; margin-bottom: 1em; }
        .prose li { margin-bottom: 0.75em; padding-left: 1.5em; position: relative; line-height: 1.6; }
        .prose li::before { content: "‚Ä¢"; color: #3b82f6; font-weight: bold; position: absolute; left: 0; }
        .check-list li::before { content: "‚úì"; color: #16a34a; }
        
        /* Cajas de Texto */
        .alert-box { background-color: #fefce8; border-left: 4px solid #eab308; padding: 1rem; margin: 1rem 0; color: #854d0e; }
        .info-box { background-color: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 1rem; margin: 1rem 0; color: #0c4a6e; }
        .tips-box { background-color: #f5f3ff; border-left: 4px solid #7c3aed; padding: 1rem; margin: 1rem 0; color: #4c1d95; font-size: 0.95em; }
        .resource-box { background-color: #eff6ff; border: 1px solid #bfdbfe; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; }
        
        /* Estilos App Interna */
        .app-container { background: white; border: 1px solid #cbd5e1; border-radius: 0.75rem; overflow: hidden; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); margin: 2rem 0; }
        .app-header { background: #1e3a8a; color: white; padding: 1rem; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: background 0.2s; }
        .app-header:hover { background: #1e40af; }
        .app-content { display: none; }
        .app-content.open { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Inputs */
        .calc-input { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; text-align: right; transition: border 0.2s; }
        .calc-input:focus { border-color: #2563eb; outline: none; }
        .calc-label { font-size: 13px; font-weight: 600; color: #475569; display: block; margin-bottom: 4px; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen text-slate-800">

    <div class="max-w-7xl mx-auto bg-white shadow-2xl my-8 rounded-xl overflow-hidden">
        
        <!-- Header -->
        <div class="bg-slate-900 text-white p-10 relative overflow-hidden">
            <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-blue-600 rounded-full opacity-20"></div>
            <h1 class="text-4xl font-bold tracking-tight mb-2">MANUAL OPERATIVO RENTIA</h1>
            <p class="text-blue-300 text-lg font-light">Rentia Investments S.L. | Master Plan Integral</p>
        </div>

        <div class="flex flex-col lg:flex-row">
            
            <!-- Sidebar / Navegaci√≥n -->
            <div class="w-full lg:w-1/4 bg-slate-50 p-6 border-r border-slate-200">
                <div class="sticky top-6">
                    <h2 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Estructura Maestra</h2>
                    <nav class="space-y-2">
                        <a href="#intro" class="block px-4 py-2 rounded text-slate-500 hover:bg-slate-200 text-sm font-medium">Inicio / Equipo</a>
                        <a href="#cap2" class="block px-4 py-2 rounded text-slate-600 hover:bg-blue-50 hover:text-blue-600 font-medium text-sm border-l-4 border-transparent hover:border-blue-400 transition">Cap√≠tulo II: Alquileres</a>
                        <a href="#cap3" class="block px-4 py-2 rounded text-slate-600 hover:bg-blue-50 hover:text-blue-600 font-medium text-sm border-l-4 border-transparent hover:border-blue-400 transition">Cap√≠tulo III: Compraventa</a>
                    </nav>
                    
                    <div class="mt-8 p-4 bg-white rounded shadow-sm border border-slate-100">
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Equipo Rentia</h3>
                        <p class="text-xs text-slate-500 mb-3 italic">Roles polivalentes:</p>
                        <ul class="text-sm space-y-2 font-semibold text-slate-700">
                            <li class="flex items-center"><span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span> Pol</li>
                            <li class="flex items-center"><span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span> Sandra</li>
                            <li class="flex items-center"><span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span> Ayup</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Contenido Principal -->
            <div class="w-full lg:w-3/4 p-8 lg:p-12" id="mainContent">

                <!-- INTRODUCCI√ìN -->
                <div id="intro" class="mb-12">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">Bienvenido al Manual Operativo</h2>
                    <p class="text-slate-600 leading-relaxed">Este documento vivo recoge todos los procedimientos est√°ndar de <strong>Rentia Investments S.L.</strong>. Su objetivo es la estandarizaci√≥n de la excelencia operativa tanto en la gesti√≥n de activos (alquileres) como en la intermediaci√≥n inmobiliaria (venta).</p>
                </div>

                <!-- ========================= CAP√çTULO II: ALQUILERES (COMPLETO) ========================= -->
                <div id="cap2" class="mb-20 pt-8 border-t border-slate-200">
                    <div class="flex items-center mb-6 pb-2 border-b-4 border-blue-600">
                        <span class="bg-blue-600 text-white w-10 h-10 flex items-center justify-center rounded-full mr-3 text-lg font-bold">2</span>
                        <h2 class="text-3xl font-bold text-slate-900">Protocolo de Captaci√≥n y Gesti√≥n de Alquileres</h2>
                    </div>

                    <!-- DIAGRAMA ALQUILER -->
                    <div class="bg-white p-4 rounded-lg shadow border border-slate-200 overflow-x-auto mb-8">
                        <div class="mermaid">
                        graph TD
                            classDef blueNode fill:#2563eb,stroke:#1e40af,stroke-width:2px,color:#fff;
                            classDef decision fill:#fef3c7,stroke:#d97706,stroke-width:2px,color:#000;
                            classDef fin fill:#fee2e2,stroke:#ef4444,stroke-width:2px,color:#000;
                            classDef inicio fill:#e0e7ff,stroke:#3730a3,stroke-width:2px,color:#000;
                            classDef verde fill:#dcfce7,stroke:#16a34a,stroke-width:2px,color:#000;
                            classDef seguimiento fill:#f3e8ff,stroke:#7e22ce,stroke-width:1px,stroke-dasharray: 5 5,color:#000;
                            classDef amarillo fill:#facc15,stroke:#b45309,stroke-width:2px,color:#000;

                            A["INICIO: Lead Propietario"]:::inicio --> B["1. Visita de Valoraci√≥n"]:::blueNode
                            B --> C["2. Estudio Mercado (IA) + Perfil"]:::blueNode
                            
                            subgraph AUDITORIA ["3. Auditor√≠a T√©cnica (Checklist)"]
                                C --> D1["Suministros:<br/>Agua/Luz/Gas/Mamparas"]
                                C --> D2["Comunidad:<br/>Vecinos/Ocupas"]
                                C --> D3["Estructura:<br/>Humedades/Suelo"]
                            end
                            
                            D1 & D2 & D3 --> E["4. Informe + Propuesta"]:::blueNode
                            E --> F{"¬øPropietario Acepta?"}:::decision
                            
                            F -- NO --> Z["SOFT LANDING:<br/>Seguimiento 1 y 3 meses"]:::fin
                            F -- SI --> G["Firma Contrato MADRE"]:::verde
                            
                            G --> H(("5. ONBOARDING"))
                            style H fill:#1e40af,color:#fff,stroke-width:0px
                            
                            subgraph PUESTAPUNTO ["Puesta a Punto"]
                                H --> I1["LLAVES:<br/>1x Hab, Sandra, Ayup, Pol, Prop"]
                                H --> I2["SUMINISTROS:<br/>Cuota Fija o Reparto<br/>Instalar IoT"]
                                H --> I3["LIMPIEZA:<br/>Pintor V. o Ayup"]
                            end
                            
                            I1 & I2 & I3 --> J["6. Material AV<br/>Fotos/Videos"]:::blueNode
                            
                            J --> K["7. Publicaci√≥n<br/>Portales + Colaboradores"]:::blueNode
                            K --> L["8. Gesti√≥n<br/>Grupos WhatsApp (Wifi)"]:::blueNode
                            L --> M{"9. Seguimiento"}:::decision
                            M --> N["D√≠a 15: Reporte"]
                            M --> O["D√≠a 30: Ajuste"]
                        </div>
                    </div>

                    <div class="prose max-w-none text-slate-600">
                        <h3>1. Fase Previa y Visita T√©cnica</h3>
                        <p><strong>Objetivo:</strong> Valorar el potencial del activo (Zona, Ascensor, Planta, Habitaciones) y detectar problemas.</p>
                        
                        <div class="alert-box">
                            <strong>‚ö†Ô∏è Auditor√≠a In-Situ (Puntos Cr√≠ticos):</strong>
                            <ul class="mt-2 text-sm list-disc pl-4">
                                <li><strong>Funcionalidad:</strong> Abrir grifos (¬øllega agua caliente al √∫ltimo ba√±o?), cisternas, luces (¬øpotencia suficiente?), manivelas, mamparas (¬øcierran bien/fugas?), electrodom√©sticos.</li>
                                <li><strong>Estructura:</strong> Manchas de humedad, grietas, pintura.</li>
                                <li><strong>Comunidad:</strong> ¬øOcupas? ¬øVecinos conflictivos? ¬øObras pendientes? <strong>Importante:</strong> Si no hay comunidad constituida, advertir que es responsabilidad del propietario crearla.</li>
                                <li><strong>Documentaci√≥n necesaria:</strong> Escritura, CEE, Seguro Vivienda, LOPD.</li>
                            </ul>
                        </div>
                        <p class="text-sm italic text-blue-800"><strong>Nota:</strong> Llevar siempre la plantilla de estudio (o usar la APP de abajo).</p>

                        <div class="my-6 p-4 bg-slate-50 border border-slate-200 rounded-lg text-center">
                            <button onclick="openPrintWindow('checklist')" class="bg-blue-800 text-white px-6 py-3 rounded-lg shadow-lg hover:bg-blue-900 transition flex items-center justify-center font-bold mx-auto w-full md:w-auto transform hover:scale-105 duration-200">
                                <i class="fas fa-print mr-3 text-xl"></i> IMPRIMIR / PDF: HOJA DE VISITA T√âCNICA
                            </button>
                            <p class="text-xs text-slate-500 mt-2">Formato A4 optimizado para uso en campo.</p>
                        </div>

                        <h4>1.2. Organizaci√≥n Interna (Protocolo Naming)</h4>
                        <div class="info-box">
                            <strong>üìÇ Nomenclatura en Drive/Sistema:</strong>
                            <ul class="text-sm list-disc pl-4 mt-1">
                                <li><strong>Contrato "MADRE":</strong> El firmado con el propietario del activo. (Incluye LOPD, Seguro vivienda, Escritura).</li>
                                <li><strong>Contratos "HIJOS":</strong> Los firmados con cada inquilino.</li>
                                <li><strong>Ejemplo:</strong> Propiedad: <code>SANTARITA</code> -> Habitaci√≥n: <code>SANTARITA_H1</code> -> Contrato: <code>SANTARITA_H1_INQUILINO</code>.</li>
                                <li><strong>Drive:</strong> Compartir carpeta con el propietario una vez subidas las fotos/v√≠deos para transparencia.</li>
                            </ul>
                        </div>

                        <h3>2. Onboarding y Mejoras (Efecto WOW)</h3>
                        <p>Para alquilar r√°pido y caro, el producto debe brillar. Recomendar siempre estas mejoras:</p>
                        <ul class="check-list space-y-2">
                            <li><strong>Confort:</strong> S√°banas iniciales, pintura si las paredes est√°n marcadas.</li>
                            <li><strong>Cocina (Vital):</strong> Menaje b√°sico (platos, cubiertos), <strong>Microondas, Tostadora, Cafetera</strong> (indispensables).</li>
                            <li><strong>Mobiliario:</strong> Si no hay mesa de comer, es MUY recomendable poner una.</li>
                            <li><strong>Conectividad:</strong> Internet veloz (recomendado <strong>Fibranet</strong>) instalado y funcionando en toda la casa.</li>
                            <li><strong>Limpieza (Vital):</strong>
                                <ul class="text-sm mt-1 list-disc pl-4 text-slate-600">
                                    <li>Renovar utensilios (escobas, mochos, trapos, cubos basura/agua).</li>
                                    <li><strong>Servicio Semanal:</strong> "Casi" obligatorio. Recomendar meter 10‚Ç¨ en la cuota para cubrirlo. "Reduce rotaci√≥n y mantiene el valor".</li>
                                </ul>
                            </li>
                            <li><strong>Seguros:</strong> Ofrecer seguro de impago por habitaci√≥n (externo). Aprox 150‚Ç¨/a√±o para hab de 300‚Ç¨.</li>
                        </ul>

                        <!-- APP GENERADORA RENTABILIDAD (Alquileres) -->
                        <div class="app-container" id="rentCalcApp">
                            <div class="app-header" onclick="toggleApp('rentCalcContent', 'toggleIconRent')">
                                <div class="flex items-center"><i class="fas fa-file-pdf text-white text-xl mr-3"></i><span class="text-lg font-bold text-white m-0 p-0">Generador Informe Rentabilidad (Desplegar)</span></div>
                                <i id="toggleIconRent" class="fas fa-chevron-down text-white transition-transform duration-300"></i>
                            </div>
                            <div id="rentCalcContent" class="app-content bg-slate-50 p-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div><label class="calc-label">Nombre Propietario</label><input type="text" id="ownerName" class="calc-input"></div>
                                    <div><label class="calc-label">Direcci√≥n Inmueble</label><input type="text" id="propAddress" class="calc-input"></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 bg-indigo-50 p-4 rounded border border-indigo-100">
                                    <div><label class="calc-label text-indigo-800">Perfil Inquilino</label><input type="text" id="targetProfile" class="calc-input" placeholder="Ej: Estudiantes"></div>
                                    <div><label class="calc-label text-indigo-800">Plazo Estimado</label><input type="text" id="estimatedTime" class="calc-input" placeholder="Ej: 15-20 d√≠as"></div>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-4">
                                    <div class="flex items-center mb-2"><span class="text-sm font-bold mr-2 text-blue-800">N¬∫ Habs:</span><input type="number" id="numRooms" class="w-16 p-1 border rounded text-center" min="1" max="10"></div>
                                    <div id="roomPricesContainer" class="grid grid-cols-2 gap-2"></div>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100 mb-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div><label class="calc-label text-green-800">Comisi√≥n Gesti√≥n (%)</label><input type="number" id="feePercent" class="calc-input text-center" placeholder="10"></div>
                                    <div><label class="calc-label text-green-800">Descuento (%)</label><input type="number" id="discountPercent" class="calc-input text-center" placeholder="0"></div>
                                    <div><label class="calc-label text-green-800">Limpieza Aprox (‚Ç¨)</label><input type="number" id="cleaningCost" class="calc-input text-center" placeholder="60"></div>
                                </div>
                                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100 mb-4">
                                    <div class="mb-2"><label class="calc-label text-yellow-800">Puntos Fuertes</label><textarea id="strongPoints" class="w-full p-2 border border-yellow-300 rounded text-sm h-12 focus:border-yellow-500 outline-none"></textarea></div>
                                    <div class="mb-2"><label class="calc-label text-yellow-800">Mejoras Necesarias</label><textarea id="improvements" class="w-full p-2 border border-yellow-300 rounded text-sm h-12 focus:border-yellow-500 outline-none"></textarea></div>
                                    <div class="flex items-center space-x-2 mt-2"><input type="checkbox" id="iotCheck" class="mr-2"><label for="iotCheck" class="text-sm text-slate-700">Incluir Medidores IoT</label></div>
                                </div>
                                <div class="mb-4"><label class="calc-label">Estudio de Zona</label><textarea id="zoneStudy" class="w-full p-2 border border-slate-300 rounded text-sm h-16 focus:border-blue-500 outline-none"></textarea></div>
                                
                                <button onclick="openPrintWindow('rental_study')" class="w-full bg-blue-600 text-white py-3 rounded font-bold hover:bg-blue-700 shadow-md transition transform hover:scale-[1.02]"><i class="fas fa-print mr-2"></i> IMPRIMIR ESTUDIO</button>
                            </div>
                        </div>

                        <h3>3. Gesti√≥n T√©cnica: Llaves, Suministros y Limpieza</h3>
                        <ul class="check-list">
                            <li><strong>Llaves:</strong> 1x Habitaci√≥n + 1x Sandra + 1x Ayup + 1x Pol + 1x Propietario. (Si faltan, se hacen y facturan).</li>
                            <li><strong>Suministros:</strong>
                                <ul class="text-sm mt-1 list-disc pl-4 text-slate-600">
                                    <li><strong>Modelo A (Cuota Fija):</strong> Explicar "equilibrio anual" (meses altos compensan bajos).</li>
                                    <li><strong>Modelo B (Reparto):</strong> Factura real. Pedir autorizaci√≥n para hablar con compa√±√≠as. <strong>Aviso:</strong> Indicar a inquilinos que excesos se pagan equitativamente.</li>
                                    <li><strong>Control:</strong> Inquilinos env√≠an foto contador mensual. Instalar medidores IoT (Amazon BSEED/OSRAM).</li>
                                </ul>
                            </li>
                            <li><strong>Contactos Limpieza:</strong>
                                <ul class="text-sm mt-1 list-disc pl-4 text-slate-600">
                                    <li><strong>Pintor Vel√°zquez (Murcia):</strong> +34 606 76 55 10 (Limpiadora Externa).</li>
                                    <li><strong>Otros Pisos:</strong> Coordinar con <strong>Ayup</strong> (Equipo de confianza).</li>
                                </ul>
                            </li>
                        </ul>

                        <h3>4. Publicaci√≥n y Gesti√≥n Diaria</h3>
                        <ul class="list-decimal pl-4 space-y-2">
                            <li><strong>Material Audiovisual:</strong> Fotos y V√≠deo General + V√≠deos espec√≠ficos de cada habitaci√≥n (presentaci√≥n).</li>
                            <li><strong>Publicaci√≥n:</strong> Idealista, Milanuncios, Wallapop y Grupos de Colaboradores.</li>
                            <li><strong>Grupos WhatsApp:</strong>
                                <ul class="text-sm mt-1 list-disc pl-4 text-slate-600">
                                    <li>Grupo 1: Propietario + Equipo Rentia.</li>
                                    <li>Grupo 2: Inquilinos + Equipo Rentia (V√≠ctor, Pol, Sandra, Ayup).</li>
                                    <li><strong>IMPORTANTE:</strong> Poner la contrase√±a del Wifi en la descripci√≥n del grupo.</li>
                                </ul>
                            </li>
                            <li><strong>Documentaci√≥n Extra:</strong> Crear y enviar PDF Mapa Cocina/Nevera y CEE al grupo.</li>
                            <li><strong>Seguimiento:</strong> Revisi√≥n diaria de portales. Reporte al propietario d√≠as 15 y 30.</li>
                            <li><strong>Datos Web:</strong> Rellenar el archivo suelto tipo Excel con precios pactados y pasarlo a <strong>Pol</strong> para actualizar la web.</li>
                        </ul>
                    </div>
                </div>

                <!-- ========================= CAP√çTULO III: COMPRAVENTA ========================= -->
                <div id="cap3" class="mb-20 pt-8 border-t border-slate-200">
                    <div class="flex items-center mb-6 pb-2 border-b-4 border-blue-600">
                        <span class="bg-blue-600 text-white w-10 h-10 flex items-center justify-center rounded-full mr-3 text-lg font-bold">3</span>
                        <h2 class="text-3xl font-bold text-slate-900">Protocolo de Compraventa</h2>
                    </div>

                    <!-- DIAGRAMA DE VENTA -->
                    <div class="bg-white p-4 rounded-lg shadow border border-slate-200 overflow-x-auto mb-8">
                        <div class="mermaid">
                        graph TD
                            classDef blueNode fill:#2563eb,stroke:#1e40af,stroke-width:2px,color:#fff;
                            classDef greenNode fill:#16a34a,stroke:#14532d,stroke-width:2px,color:#fff;
                            classDef yellowNode fill:#facc15,stroke:#a16207,stroke-width:2px,color:#000;

                            A[INICIO: Lead Vendedor]:::blueNode --> B[Valoraci√≥n ACM + Visita]
                            B --> C{¬øFirma Encargo?}
                            C -- NO --> Z[Seguimiento]
                            C -- SI --> D[Firma Nota Encargo]:::greenNode
                            D --> E[MARKETING]:::yellowNode
                            E --> G[Publicaci√≥n]
                            G --> H[Filtro Compradores]
                            H --> I{¬øFinancieramente OK?}
                            I -- SI --> K[VISITA EMOCIONAL]:::blueNode
                            K --> M[Negociaci√≥n]
                            M --> N[CONTRATO ARRAS]:::greenNode
                            N --> O[NOTAR√çA]:::blueNode
                        </div>
                    </div>

                    <div class="prose max-w-none text-slate-600 mb-8">
                        <h3>1. Captaci√≥n y Cualificaci√≥n</h3>
                        <p><strong>Objetivo:</strong> Captar en precio. Si la desviaci√≥n expectativa/mercado es >20%, no captar.</p>
                        <div class="tips-box">
                            <strong>üó£Ô∏è Script Defensa de Precio:</strong><br>
                            <em>"Entiendo que quieras pedir 150.000‚Ç¨... pero el mercado dice 135.000‚Ç¨. Si salimos caros, ayudaremos a vender los pisos de tus vecinos (porque parecer√°n baratos). ¬øQuieres vender el tuyo o ayudar a los vecinos?"</em>
                        </div>
                        <ul class="check-list mt-2">
                            <li><strong>Documentaci√≥n Vital:</strong> Nota Simple (< 3 meses), CEE, Recibo IBI, Certificado Comunidad.</li>
                        </ul>

                        <h3>2. Filtro Financiero Compradores</h3>
                        <div class="alert-box">
                            <strong>üìû Las 3 Preguntas de Oro:</strong>
                            <ol class="list-decimal pl-4 text-sm mt-1">
                                <li><em>"¬øCompras al contado o necesitas financiaci√≥n?"</em></li>
                                <li><em>"Si es hipoteca: ¬øYa tienes pre-aprobaci√≥n bancaria?"</em></li>
                                <li><em>"¬øDispones del 30% de fondos propios?"</em></li>
                            </ol>
                        </div>

                        <h3>3. Calculadora de Cierre</h3>
                        <p>Utiliza esta calculadora para generar la <strong>Hoja de Liquidaci√≥n (Vendedor)</strong> o la <strong>Hoja de Costes (Comprador)</strong>.</p>
                    </div>

                    <!-- APP CALCULADORA COMPRAVENTA V2 -->
                    <div class="app-container" id="salesCalcApp">
                        <div class="app-header" onclick="toggleApp('salesAppContent', 'toggleSalesIcon')">
                            <div class="flex items-center"><i class="fas fa-calculator text-white text-xl mr-3"></i><span class="text-lg font-bold text-white m-0 p-0">Calculadora de Cierre (Vendedor/Comprador)</span></div>
                            <i id="toggleSalesIcon" class="fas fa-chevron-down text-white transition-transform duration-300"></i>
                        </div>
                        <div id="salesAppContent" class="app-content bg-slate-50 p-6">
                            <div class="flex mb-4 border-b border-slate-300">
                                <button onclick="switchTab('seller')" id="btnSeller" class="px-4 py-2 font-bold text-blue-600 border-b-2 border-blue-600 bg-blue-50 w-1/2 transition">Para Vendedor</button>
                                <button onclick="switchTab('buyer')" id="btnBuyer" class="px-4 py-2 font-bold text-slate-500 w-1/2 transition">Para Comprador</button>
                            </div>
                            
                            <!-- Vendedor -->
                            <div id="tabSeller" class="block">
                                <div class="space-y-3">
                                    <div><label class="calc-label">Precio Venta (‚Ç¨)</label><input type="number" id="s_price" class="calc-input font-bold text-blue-900 bg-white" oninput="calcSeller()"></div>
                                    <div class="flex items-center justify-between mb-1"><label class="calc-label">Hipoteca Pendiente</label><input type="checkbox" id="s_has_mortgage" onchange="toggleSellerMortgage()"></div>
                                    <input type="number" id="s_mortgage" class="calc-input text-red-700 disabled:bg-slate-100 disabled:text-slate-400" oninput="calcSeller()" placeholder="0" disabled>
                                    <div><label class="calc-label">Honorarios Rentia (+ IVA)</label><div class="flex items-center space-x-2"><select id="s_fee_type" onchange="calcSeller()" class="p-1 border rounded text-sm"><option value="percent">%</option><option value="fixed">‚Ç¨</option></select><input type="number" id="s_fee_value" class="calc-input w-24" oninput="calcSeller()" value="3"><input type="text" id="s_fee_total" class="calc-input bg-slate-100 text-red-700 text-xs font-bold" readonly></div></div>
                                    <div><label class="calc-label">Plusval√≠a / Otros (‚Ç¨)</label><input type="number" id="s_plusvalia" class="calc-input text-red-700" oninput="calcSeller()" value="500"></div>
                                    <div class="bg-white p-4 rounded border text-center border-slate-200 shadow-sm">
                                        <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider">NETO A PERCIBIR</h4>
                                        <span class="text-3xl font-bold text-green-600" id="s_net_result">0 ‚Ç¨</span>
                                    </div>
                                    <button onclick="openPrintWindow('sales_seller')" class="w-full bg-slate-800 text-white py-3 rounded font-bold hover:bg-slate-900 transition transform hover:scale-[1.02]"><i class="fas fa-print mr-2"></i> IMPRIMIR INFORME</button>
                                </div>
                            </div>
                            <!-- Comprador -->
                            <div id="tabBuyer" class="hidden">
                                <div class="space-y-3">
                                    <div><label class="calc-label">Precio Compra (‚Ç¨)</label><input type="number" id="b_price" class="calc-input font-bold text-blue-900 bg-white" oninput="calcBuyer()"></div>
                                    <div><label class="calc-label">Honorarios Agencia (+ IVA)</label><div class="flex items-center space-x-2"><select id="b_fee_type" onchange="calcBuyer()" class="p-1 border rounded text-sm"><option value="percent">%</option><option value="fixed">‚Ç¨</option></select><input type="number" id="b_fee_value" class="calc-input w-24" oninput="calcBuyer()" value="0"><input type="text" id="b_fee_total" class="calc-input bg-slate-100 text-red-700 text-xs font-bold" readonly></div></div>
                                    <div class="grid grid-cols-2 gap-2"><div><label class="calc-label">ITP (%)</label><input type="number" id="b_itp_percent" class="calc-input" oninput="calcBuyer()" value="8"></div><div><label class="calc-label">Notar√≠a/Reg</label><input type="number" id="b_expenses_fix" class="calc-input" oninput="calcBuyer()" value="1500"></div></div>
                                    <div class="bg-indigo-50 p-2 rounded border border-indigo-100"><div class="flex items-center mb-1"><input type="checkbox" id="b_needs_mortgage" class="mr-2" onchange="toggleBuyerMortgage()"><label class="text-xs font-bold text-indigo-900">¬øNecesita Hipoteca?</label></div><div id="mortgageFields" class="hidden grid grid-cols-2 gap-2 mt-1"><input type="number" id="b_appraisal" class="calc-input text-xs" oninput="calcBuyer()" placeholder="Tasaci√≥n"><input type="number" id="b_bank_fees" class="calc-input text-xs" oninput="calcBuyer()" placeholder="Comisi√≥n"></div></div>
                                    <div class="bg-white p-4 rounded border text-center"><h4 class="text-xs font-bold text-blue-800 uppercase">COSTE TOTAL</h4><span class="text-3xl font-bold text-blue-900" id="b_total_cost">0 ‚Ç¨</span></div>
                                    <button onclick="openPrintWindow('sales_buyer')" class="w-full bg-blue-800 text-white py-3 rounded font-bold hover:bg-blue-900 transition transform hover:scale-[1.02]"><i class="fas fa-print mr-2"></i> IMPRIMIR HOJA COSTES</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Scripts JS -->
    <script>
        function toggleApp(id, icon) {
            const el = document.getElementById(id); const ic = document.getElementById(icon);
            if(el.classList.contains('open')){ el.classList.remove('open'); ic.style.transform='rotate(0deg)'; setTimeout(()=>el.style.display='none',300); }
            else { el.style.display='block'; setTimeout(()=>{el.classList.add('open'); ic.style.transform='rotate(180deg)';},10); }
        }
        
        document.getElementById('numRooms').addEventListener('input', function() {
            const c = document.getElementById('roomPricesContainer'); c.innerHTML = ''; 
            const n = parseInt(this.value)||0;
            for(let i=1; i<=n; i++) c.innerHTML+=`<div class="flex items-center space-x-2 bg-blue-50 p-2 rounded"><label class="text-xs font-bold text-blue-800 w-12">Hab ${i}:</label><input type="number" class="room-price-input w-full p-1 border rounded text-sm text-right" placeholder="0">‚Ç¨</div>`;
        });

        function switchTab(t) {
            document.getElementById('tabSeller').className = t==='seller'?'block animate-fade-in':'hidden';
            document.getElementById('tabBuyer').className = t==='buyer'?'block animate-fade-in':'hidden';
            document.getElementById('btnSeller').className = t==='seller'?'px-4 py-2 font-bold text-blue-600 border-b-2 border-blue-600 bg-blue-50 w-1/2 transition':'px-4 py-2 font-bold text-slate-500 w-1/2 transition';
            document.getElementById('btnBuyer').className = t==='buyer'?'px-4 py-2 font-bold text-blue-600 border-b-2 border-blue-600 bg-blue-50 w-1/2 transition':'px-4 py-2 font-bold text-slate-500 w-1/2 transition';
        }
        
        function toggleSellerMortgage() { const chk=document.getElementById('s_has_mortgage'); document.getElementById('s_mortgage').disabled=!chk.checked; calcSeller(); }
        function toggleBuyerMortgage() { const chk=document.getElementById('b_needs_mortgage'); document.getElementById('mortgageFields').classList.toggle('hidden',!chk.checked); calcBuyer(); }
        
        function getFee(price, type, val) { return (type==='percent'?price*(val/100):val)*1.21; }

        function calcSeller() {
            const p = parseFloat(document.getElementById('s_price').value)||0; 
            const m = document.getElementById('s_has_mortgage').checked ? parseFloat(document.getElementById('s_mortgage').value)||0 : 0;
            const fee = getFee(p, document.getElementById('s_fee_type').value, parseFloat(document.getElementById('s_fee_value').value)||0);
            document.getElementById('s_fee_total').value = fee.toLocaleString('es-ES',{maximumFractionDigits:0})+' ‚Ç¨';
            document.getElementById('s_net_result').innerText = (p - m - fee - (parseFloat(document.getElementById('s_plusvalia').value)||0)).toLocaleString('es-ES') + ' ‚Ç¨';
        }

        function calcBuyer() {
            const p = parseFloat(document.getElementById('b_price').value)||0;
            const fee = getFee(p, document.getElementById('b_fee_type').value, parseFloat(document.getElementById('b_fee_value').value)||0);
            document.getElementById('b_fee_total').value = fee.toLocaleString('es-ES',{maximumFractionDigits:0})+' ‚Ç¨';
            const itp = p * ((parseFloat(document.getElementById('b_itp_percent').value)||0)/100);
            const exp = parseFloat(document.getElementById('b_expenses_fix').value)||0; // Notaria+Reg
            const mort = document.getElementById('b_needs_mortgage').checked ? (parseFloat(document.getElementById('b_appraisal').value)||0 + parseFloat(document.getElementById('b_bank_fees').value)||0) : 0;
            document.getElementById('b_total_cost').innerText = (p + itp + fee + exp + mort).toLocaleString('es-ES') + ' ‚Ç¨';
        }

        // --- SISTEMA DE IMPRESI√ìN NATIVO (V38 - Definitivo) ---
        function openPrintWindow(type) {
            let content = ''; const today = new Date().toLocaleDateString('es-ES');
            
            if (type === 'checklist') {
                content = `<div style="font-family:Arial; padding:40px; max-width:800px; margin:0 auto;">
                    <h1 style="color:#1e3a8a; border-bottom:3px solid #1e3a8a;">HOJA DE VISITA T√âCNICA</h1>
                    <p style="margin-bottom:30px;"><strong>Direcci√≥n:</strong> ________________________________________</p>
                    <h3 style="background:#f1f5f9; padding:5px; color:#1e3a8a;">1. FUNCIONALIDAD</h3>
                    <p style="line-height:2.5;">‚ñ¢ Grifos ___ ‚ñ¢ Luces ___ ‚ñ¢ Ventanas ___ ‚ñ¢ Manivelas ___ ‚ñ¢ Mampara ___</p>
                    <h3 style="background:#f1f5f9; padding:5px; color:#1e3a8a;">2. ESTADO Y SUMINISTROS</h3>
                    <p style="line-height:2.5;">‚ñ¢ Humedades ___ ‚ñ¢ Pintura ___ ‚ñ¢ Cuadro El√©ctrico ___ ‚ñ¢ Termo/Gas ___</p>
                    <h3 style="background:#f1f5f9; padding:5px; color:#1e3a8a;">3. COMUNIDAD</h3>
                    <p style="line-height:2.5;">‚ñ¢ Limpieza ___ ‚ñ¢ Ocupas/Vecinos ___ ‚ñ¢ Ascensor ___</p>
                    <h3 style="background:#f1f5f9; padding:5px; color:#1e3a8a;">4. CROQUIS / NOTAS</h3><div style="border:1px solid #ccc; height:300px;"></div>
                    <div style="margin-top:30px; text-align:center; font-size:10px; color:#aaa;">Rentia Investments S.L.</div>
                </div>`;
            } 
            else if (type === 'rental_study') {
                let rooms = ''; let total = 0;
                document.querySelectorAll('.room-price-input').forEach((inp, i) => {
                    const v = parseFloat(inp.value)||0; total+=v;
                    rooms += `<li>Hab ${i+1}: <strong>${v} ‚Ç¨</strong></li>`;
                });
                const feeP = parseFloat(document.getElementById('feePercent').value)||0;
                const disc = parseFloat(document.getElementById('discountPercent').value)||0;
                const fee = total * (feeP/100) * (1-(disc/100)) * 1.21;
                const clean = parseFloat(document.getElementById('cleaningCost').value)||0;
                
                content = `<div style="font-family:Arial; padding:40px; max-width:800px; margin:0 auto;">
                    <h1 style="color:#1e3a8a; border-bottom:3px solid #1e3a8a;">ESTUDIO RENTABILIDAD</h1>
                    <p><strong>Propiedad:</strong> ${document.getElementById('propAddress').value}</p>
                    <p><strong>Estrategia:</strong> ${document.getElementById('targetProfile').value} | ${document.getElementById('estimatedTime').value}</p>
                    <div style="background:#f8fafc; padding:20px; margin:20px 0;">
                        <h3>INGRESOS ESTIMADOS</h3>
                        <ul style="padding:0;">${roomHtml}</ul>
                        <p style="text-align:right; font-size:20px; font-weight:bold; color:#1e3a8a;">TOTAL: ${total} ‚Ç¨</p>
                    </div>
                    <div style="background:#f0fdf4; padding:20px; border:1px solid #bbf7d0;">
                        <h3 style="color:#166534;">NETO PROPIETARIO</h3>
                        <p>Honorarios: -${(finalFee * 1.21).toFixed(2)} ‚Ç¨ (IVA inc.)</p>
                        <p>Limpieza Estimada: -${clean} ‚Ç¨</p>
                        <p style="font-size:24px; font-weight:bold; text-align:right; color:#15803d;">${(total-fee-clean).toFixed(2)} ‚Ç¨</p>
                    </div>
                    <div style="margin-top:20px;"><strong>Puntos Fuertes:</strong> ${document.getElementById('strongPoints').value}</div>
                    <div style="margin-top:10px;"><strong>Mejoras:</strong> ${document.getElementById('improvements').value}</div>
                    <div style="margin-top:30px; font-size:10px; color:#aaa;">Rentia Investments S.L. - Documento informativo sin validez contractual.</div>
                </div>`;
            }
            else if (type.startsWith('sales')) {
                 const isSeller = type === 'sales_seller';
                 const price = document.getElementById(isSeller?'s_price':'b_price').value;
                 const result = document.getElementById(isSeller?'s_net_result':'b_total_cost').innerText;
                 content = `<div style="font-family:Arial; padding:40px; max-width:800px; margin:0 auto;">
                    <h1 style="color:#1e3a8a; border-bottom:3px solid #1e3a8a;">VALORACI√ìN ECON√ìMICA</h1>
                    <div style="background:${isSeller?'#f0fdf4':'#eff6ff'}; padding:30px; margin-top:20px; border-radius:10px;">
                        <h2 style="margin:0;">${isSeller?'LIQUIDACI√ìN VENDEDOR':'COSTE ADQUISICI√ìN'}</h2>
                        <p style="font-size:18px; margin-top:10px;">Precio Base: <strong>${price} ‚Ç¨</strong></p>
                        <hr style="border:1px dashed #ccc; margin:20px 0;">
                        <p style="font-size:32px; font-weight:bold; color:#1e3a8a; text-align:right; margin:0;">${result}</p>
                        <p style="font-size:12px; text-align:right; margin:0;">(Cifra final estimada con impuestos/gastos incluidos)</p>
                    </div>
                    <div style="font-size:10px; color:#999; margin-top:40px; text-align:center;">Rentia Investments S.L. - Documento informativo no contractual.</div>
                </div>`;
            }

            const win = window.open('', '_blank');
            win.document.write('<html><head><title>Imprimir</title></head><body style="margin:0; padding:0;">' + content + '</body></html>');
            win.document.close();
            setTimeout(() => { win.focus(); win.print(); }, 500);
        }
    </script>
</body>
</html>