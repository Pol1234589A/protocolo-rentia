<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Operativo Rentia Investments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            securityLevel: 'loose',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#fff',
                primaryBorderColor: '#1e40af',
                lineColor: '#334155',
                secondaryColor: '#eff6ff',
                tertiaryColor: '#fff'
            }
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .prose h3 { color: #1e3a8a; margin-top: 2.5em; font-weight: 800; font-size: 1.4rem; border-bottom: 3px solid #e2e8f0; padding-bottom: 0.5rem; }
        .prose h4 { color: #2563eb; margin-top: 1.5em; font-weight: 700; font-size: 1.15rem; }
        .prose ul { list-style-type: none; padding-left: 0; margin-bottom: 1em; }
        .prose li { margin-bottom: 0.75em; padding-left: 1.5em; position: relative; line-height: 1.6; }
        .prose li::before { content: "‚Ä¢"; color: #3b82f6; font-weight: bold; position: absolute; left: 0; }
        .check-list li::before { content: "‚úì"; color: #16a34a; }
        .alert-box { background-color: #fefce8; border-left: 4px solid #eab308; padding: 1rem; margin: 1rem 0; color: #854d0e; }
        .info-box { background-color: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 1rem; margin: 1rem 0; color: #0c4a6e; }
        .tips-box { background-color: #f5f3ff; border-left: 4px solid #7c3aed; padding: 1rem; margin: 1rem 0; color: #4c1d95; font-size: 0.95em; }
        .resource-box { background-color: #eff6ff; border: 1px solid #bfdbfe; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; }
        
        /* Estilos App Interna */
        .app-container { background: white; border: 1px solid #cbd5e1; border-radius: 0.75rem; overflow: hidden; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); margin: 2rem 0; }
        .app-header { background: #1e3a8a; color: white; padding: 1rem; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: background 0.2s; }
        .app-header:hover { background: #1e40af; }
        .app-content { display: none; } /* Oculto por defecto */
        .app-content.open { display: block; animation: slideDown 0.3s ease-out; }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Tablas de Calculadora */
        .calc-input { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; text-align: right; }
        .calc-label { font-size: 13px; font-weight: 600; color: #475569; }
        .calc-result { font-weight: bold; color: #1e3a8a; text-align: right; }
        .calc-row-disabled { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen text-slate-800">

    <div class="max-w-6xl mx-auto bg-white shadow-2xl my-8 rounded-xl overflow-hidden">
        
        <!-- Header -->
        <div class="bg-slate-900 text-white p-10 relative overflow-hidden">
            <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-blue-600 rounded-full opacity-20"></div>
            <h1 class="text-4xl font-bold tracking-tight mb-2">MANUAL OPERATIVO RENTIA</h1>
            <p class="text-blue-300 text-lg font-light">Rentia Investments S.L. | Master Plan Integral</p>
        </div>

        <div class="flex flex-col lg:flex-row">
            
            <!-- Sidebar / √çndice General -->
            <div class="w-full lg:w-1/4 bg-slate-50 p-6 border-r border-slate-200">
                <div class="sticky top-6">
                    <h2 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Estructura Maestra</h2>
                    <nav class="space-y-2">
                        <a href="#intro" class="block px-4 py-2 rounded text-slate-500 hover:bg-slate-200 text-sm">Inicio / Equipo</a>
                        <a href="#cap2" class="block px-4 py-2 rounded text-slate-600 hover:bg-blue-50 hover:text-blue-600 font-medium text-sm border-l-4 border-transparent hover:border-blue-400">Cap√≠tulo II: Alquileres</a>
                        <a href="#cap3" class="block px-4 py-2 rounded text-slate-600 hover:bg-blue-50 hover:text-blue-600 font-medium text-sm border-l-4 border-transparent hover:border-blue-400">Cap√≠tulo III: Compraventa</a>
                        <a href="#" class="block px-4 py-2 rounded text-slate-400 text-sm cursor-not-allowed">Cap√≠tulo IV: Marketing (Pendiente)</a>
                    </nav>
                    
                    <div class="mt-8 p-4 bg-white rounded shadow-sm border border-slate-100">
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Equipo Rentia</h3>
                        <p class="text-xs text-slate-500 mb-3 italic">Roles polivalentes:</p>
                        <ul class="text-sm space-y-2 font-semibold text-slate-700">
                            <li class="flex items-center"><span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span> Pol</li>
                            <li class="flex items-center"><span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span> Sandra</li>
                            <li class="flex items-center"><span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span> Ayup</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Contenido Principal -->
            <div class="w-full lg:w-3/4 p-8 lg:p-12" id="mainContent">

                <!-- INTRODUCCI√ìN -->
                <div id="intro" class="mb-12">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">Bienvenido al Manual Operativo</h2>
                    <p class="text-slate-600">Este documento vivo recoge todos los procedimientos est√°ndar de <strong>Rentia Investments S.L.</strong>. Su objetivo es la estandarizaci√≥n de la excelencia operativa.</p>
                </div>

                <!-- ========================= CAP√çTULO II: ALQUILERES (COMPLETO RESTAURADO) ========================= -->
                <div id="cap2" class="mb-20 pt-8 border-t border-slate-200">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6 flex items-center border-b-4 border-blue-600 pb-2">
                        <span class="bg-blue-600 text-white w-10 h-10 flex items-center justify-center rounded-full mr-3 text-lg">2</span>
                        Cap√≠tulo II: Protocolo de Captaci√≥n y Gesti√≥n de Alquileres
                    </h2>
                    
                    <!-- DIAGRAMA ALQUILER -->
                    <div class="bg-white p-4 rounded-lg shadow border border-slate-200 overflow-x-auto mb-8">
                        <div class="mermaid">
                        graph TD
                            classDef blueNode fill:#2563eb,stroke:#1e40af,stroke-width:2px,color:#fff;
                            classDef decision fill:#fef3c7,stroke:#d97706,stroke-width:2px,color:#000;
                            classDef fin fill:#fee2e2,stroke:#ef4444,stroke-width:2px,color:#000;
                            classDef inicio fill:#e0e7ff,stroke:#3730a3,stroke-width:2px,color:#000;
                            classDef verde fill:#dcfce7,stroke:#16a34a,stroke-width:2px,color:#000;
                            classDef seguimiento fill:#f3e8ff,stroke:#7e22ce,stroke-width:1px,stroke-dasharray: 5 5,color:#000;
                            classDef amarillo fill:#facc15,stroke:#b45309,stroke-width:2px,color:#000;

                            A["INICIO: Lead Propietario"]:::inicio --> B["Llamada Inicial"]:::blueNode
                            B --> C["Visita T√©cnica (Auditor√≠a)"]:::blueNode
                            
                            subgraph AUDITORIA ["Auditor√≠a In-Situ"]
                                C --> D1["Revisar Humedades/Grifos"]
                                C --> D2["Revisar Comunidad"]
                                C --> D3["Fotos Desperfectos"]
                            end
                            
                            D1 & D2 & D3 --> E["Informe IA + Propuesta Rentia"]:::blueNode
                            
                            E --> F{"¬øAcepta?"}:::decision
                            
                            F -- No --> Z["SOFT LANDING:<br/>Web + Consultas"]:::fin
                            Z -.-> S1["1 MES: Seguimiento"]:::seguimiento
                            S1 -.-> S2["3 MESES: Recuperaci√≥n"]:::seguimiento
                            
                            F -- S√≠ --> G["Firma Digital Rentger + GDPR"]:::verde
                            
                            G --> H(("ONBOARDING"))
                            style H fill:#1e40af,color:#fff,stroke-width:0px
                            
                            subgraph PUESTAPUNTO ["Puesta a Punto"]
                                H --> I1["Llaves (Copias)"]
                                H --> I2["Enchufes IoT"]
                                H --> I3["Mapas Cocina"]
                            end
                            
                            I1 & I2 & I3 --> J["Producci√≥n AV"]:::blueNode
                            
                            J --> K["Carga Datos (Rentger/Web)"]:::blueNode
                            
                            K --> M["LANZAMIENTO"]:::amarillo
                            M --> N["Grupos WhatsApp"]:::blueNode
                            N --> O{"Seguimiento"}:::decision
                            O --> P["D√≠a 15: Objeciones"]:::blueNode
                            O --> Q["D√≠a 30: Ajuste"]:::blueNode
                        </div>
                    </div>

                    <div class="prose max-w-none text-slate-600">
                        <h3>1. Fase Previa y Visita T√©cnica</h3>
                        <p><strong>Objetivo:</strong> Filtrar calidad y evitar sorpresas. No perder el tiempo.</p>
                        
                        <h4>1.1. Auditor√≠a In-Situ</h4>
                        <div class="alert-box">
                            <strong>‚ö†Ô∏è Puntos Cr√≠ticos:</strong>
                            <ul class="mt-2 text-sm">
                                <li><strong>Funcionalidad:</strong> Abrir grifos, tirar cadena, probar manivelas y luces.</li>
                                <li><strong>Estructura:</strong> Buscar manchas de humedad activas o antiguas, grietas.</li>
                                <li><strong>Edificio:</strong> ¬øHay obras a medias? ¬øObras futuras? ¬øQu√© pinta tienen los vecinos? ¬øAscensor?</li>
                                <li><strong>Entorno:</strong> Servicios, calle, transporte.</li>
                            </ul>
                        </div>

                        <!-- BOT√ìN DESCARGAR CHECKLIST DE CAMPO -->
                        <div class="my-6 p-4 bg-slate-50 border border-slate-200 rounded-lg text-center">
                            <button onclick="openPrintWindow('checklist')" class="bg-blue-800 text-white px-6 py-3 rounded-lg shadow-lg hover:bg-blue-900 transition flex items-center justify-center font-bold mx-auto w-full md:w-auto">
                                <i class="fas fa-print mr-3 text-xl"></i> IMPRIMIR / PDF: HOJA DE VISITA
                            </button>
                            <p class="text-xs text-slate-500 mt-2">Se abrir√° una nueva ventana lista para imprimir.</p>
                        </div>

                        <h4>1.2. Propuesta y Cierre</h4>
                        <ul class="check-list">
                            <li>Realizar estudio de mercado posterior (Informe IA).</li>
                            <li><strong>Pol√≠tica Comercial:</strong> Ofrecer descuentos por volumen (m√°s pisos) o referidos.</li>
                            <li><strong>Si NO acepta (Soft Landing):</strong> Agradecer, redirigir a web y seguimiento a 1 y 3 meses.</li>
                        </ul>

                        <!-- APP GENERADORA RENTABILIDAD (Alquileres) -->
                        <div class="app-container" id="rentCalcApp">
                            <div class="app-header" onclick="toggleApp('rentCalcContent', 'toggleIconRent')">
                                <div class="flex items-center">
                                    <i class="fas fa-file-pdf text-white text-xl mr-3"></i>
                                    <span class="text-lg font-bold text-white m-0 p-0">Generador de Informe Rentabilidad (Desplegar)</span>
                                </div>
                                <i id="toggleIconRent" class="fas fa-chevron-down text-white transition-transform duration-300"></i>
                            </div>
                            
                            <div id="rentCalcContent" class="app-content bg-slate-50 p-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div><label class="block text-xs font-bold text-slate-700 mb-1">Nombre Propietario</label><input type="text" id="ownerName" class="w-full p-2 border border-slate-300 rounded text-sm focus:border-blue-500 outline-none"></div>
                                    <div><label class="block text-xs font-bold text-slate-700 mb-1">Direcci√≥n Inmueble</label><input type="text" id="propAddress" class="w-full p-2 border border-slate-300 rounded text-sm focus:border-blue-500 outline-none"></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 bg-indigo-50 p-4 rounded border border-indigo-100">
                                    <div><label class="block text-xs text-slate-600 mb-1">Perfil Inquilino</label><input type="text" id="targetProfile" class="w-full p-2 border border-indigo-200 rounded text-sm focus:border-indigo-500 outline-none" placeholder="Ej: Estudiantes"></div>
                                    <div><label class="block text-xs text-slate-600 mb-1">Plazo Estimado</label><input type="text" id="estimatedTime" class="w-full p-2 border border-indigo-200 rounded text-sm focus:border-indigo-500 outline-none" placeholder="Ej: 15-20 d√≠as"></div>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-4">
                                    <div class="flex items-center space-x-4 mb-3">
                                        <span class="text-sm font-bold text-blue-800">N¬∫ Habitaciones:</span>
                                        <input type="number" id="numRooms" class="w-20 p-2 border border-blue-300 rounded text-sm text-center font-bold" min="1" max="10" placeholder="0">
                                    </div>
                                    <div id="roomPricesContainer" class="grid grid-cols-1 md:grid-cols-2 gap-2"></div>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100 mb-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div><label class="block text-xs text-slate-600 mb-1">Comisi√≥n Gesti√≥n (%)</label><input type="number" id="feePercent" class="w-full p-2 border border-green-200 rounded text-sm text-center font-bold" placeholder="10"></div>
                                    <div><label class="block text-xs text-slate-600 mb-1">Descuento (%)</label><input type="number" id="discountPercent" class="w-full p-2 border border-green-200 rounded text-sm text-center font-bold" placeholder="0"></div>
                                    <div><label class="block text-xs text-slate-600 mb-1">Limpieza Aprox (‚Ç¨)</label><input type="number" id="cleaningCost" class="w-full p-2 border border-green-200 rounded text-sm text-center font-bold" placeholder="60"></div>
                                </div>
                                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100 mb-4">
                                    <div class="mb-2"><label class="block text-xs font-bold text-yellow-800 mb-1">Puntos Fuertes</label><textarea id="strongPoints" class="w-full p-2 border border-yellow-300 rounded text-sm h-12 focus:border-yellow-500 outline-none"></textarea></div>
                                    <div class="mb-2"><label class="block text-xs font-bold text-yellow-800 mb-1">Mejoras Necesarias</label><textarea id="improvements" class="w-full p-2 border border-yellow-300 rounded text-sm h-12 focus:border-yellow-500 outline-none"></textarea></div>
                                    <div class="flex items-center space-x-2 mt-2"><input type="checkbox" id="iotCheck" class="w-4 h-4 text-blue-600 rounded"><label for="iotCheck" class="text-sm text-slate-700">Incluir Medidores IoT</label></div>
                                </div>
                                <div class="mb-4"><label class="block text-xs font-bold text-slate-700 mb-1">Estudio de Zona</label><textarea id="zoneStudy" class="w-full p-2 border border-slate-300 rounded text-sm h-16 focus:border-blue-500 outline-none"></textarea></div>
                                
                                <button onclick="openPrintWindow('rental_study')" class="bg-blue-600 text-white px-6 py-2 rounded shadow hover:bg-blue-700 transition font-bold text-sm flex items-center w-full justify-center md:w-auto mb-4"><i class="fas fa-print mr-2"></i> GENERAR VISTA DE IMPRESI√ìN</button>
                            </div>
                        </div>

                        <h3>2. Onboarding y Puesta a Punto</h3>
                        <ul class="check-list">
                            <li><strong>Llaves:</strong> 1x Habitaci√≥n + 1x Sandra + 1x Ayup + 1x Pol + 1x Propietario. Si faltan, se hacen y se facturan.</li>
                            <li><strong>Suministros:</strong>
                                <ul class="text-sm mt-1 list-disc pl-4">
                                    <li><strong>Modelo A (Cuota Fija):</strong> Explicar al propietario el "equilibrio anual" (meses altos vs bajos).</li>
                                    <li><strong>Modelo B (Reparto):</strong> Factura real. Pedir autorizaci√≥n para gestionar compa√±√≠as.</li>
                                    <li><strong>Control:</strong> Inquilinos env√≠an foto contador mensual. Instalar medidores IoT (Amazon BSEED/OSRAM).</li>
                                </ul>
                            </li>
                        </ul>

                        <h4>2.4. Limpieza y Organizaci√≥n (Punto Cr√≠tico)</h4>
                        <p>Se recomienda encarecidamente contratar limpieza semanal (1-2h) pagada directamente por el propietario. Argumento: "Reduce rotaci√≥n y mantiene el piso nuevo".</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2 mb-4">
                            <div class="bg-white p-3 rounded border border-slate-200">
                                <strong>Opci√≥n A: Pintor Vel√°zquez (Murcia)</strong><br>
                                üìû <span class="font-mono bg-slate-100 px-1 rounded text-lg">+34 606 76 55 10</span><br>
                                <span class="text-xs text-slate-500 italic">Limpiadora externa espec√≠fica.</span>
                            </div>
                            <div class="bg-white p-3 rounded border border-slate-200">
                                <strong>Opci√≥n B: Resto de Pisos</strong><br>
                                üë§ <strong>Coordinar con Ayup</strong><br>
                                <span class="text-xs text-slate-500 italic">Equipo de confianza general.</span>
                            </div>
                        </div>
                        <p><strong>Documentaci√≥n Interna:</strong> Generar y entregar Mapa Cocina (armarios asignados) y Mapa Nevera.</p>

                        <h3>3. Producci√≥n y Carga de Datos</h3>
                        <ul>
                            <li><strong>Material:</strong> Fotos, Tour Horizontal, Reels Verticales.</li>
                            <li><strong>Datos:</strong> Rentger + Excel Suelto + Web (Pol) + Portales.</li>
                        </ul>

                        <h3>4. Gesti√≥n Diaria y Seguimiento</h3>
                        <p>Grupos WhatsApp (Propietarios / Inquilinos). Alertas de mercado si sale competencia fuerte. Reporte a los 15 y 30 d√≠as.</p>
                    </div>
                </div>

                <!-- ========================= CAP√çTULO III: COMPRAVENTA (COMPLETO) ========================= -->
                <div id="cap3" class="mb-20 pt-8 border-t border-slate-200">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6 flex items-center border-b-4 border-blue-600 pb-2">
                        <span class="bg-blue-600 text-white w-10 h-10 flex items-center justify-center rounded-full mr-3 text-lg">3</span>
                        Cap√≠tulo III: Protocolo de Compraventa
                    </h2>

                    <!-- DIAGRAMA DE VENTA -->
                    <div class="bg-white p-4 rounded-lg shadow border border-slate-200 overflow-x-auto mb-8">
                        <div class="mermaid">
                        graph TD
                            classDef blueNode fill:#2563eb,stroke:#1e40af,stroke-width:2px,color:#fff;
                            classDef greenNode fill:#16a34a,stroke:#14532d,stroke-width:2px,color:#fff;
                            classDef yellowNode fill:#facc15,stroke:#a16207,stroke-width:2px,color:#000;

                            A[INICIO: Lead Vendedor]:::blueNode --> B[Valoraci√≥n ACM + Visita]
                            B --> C{¬øFirma Encargo?}
                            C -- NO --> Z[Seguimiento]
                            C -- SI --> D[Firma Nota Encargo]:::greenNode
                            D --> E[MARKETING]:::yellowNode
                            E --> G[Publicaci√≥n]
                            G --> H[Filtro Compradores]
                            H --> I{¬øFinancieramente OK?}
                            I -- SI --> K[VISITA EMOCIONAL]:::blueNode
                            K --> M[Negociaci√≥n]
                            M --> N[CONTRATO ARRAS]:::greenNode
                            N --> O[NOTAR√çA]:::blueNode
                        </div>
                    </div>

                    <div class="prose max-w-none text-slate-600 mb-8">
                        <h3>1. Captaci√≥n y Cualificaci√≥n</h3>
                        <p><strong>Objetivo:</strong> Captar en precio. Si la desviaci√≥n expectativa/mercado es >20%, no captar.</p>
                        <div class="tips-box">
                            <strong>üó£Ô∏è Script: Defendiendo el Precio</strong><br>
                            <em>"Entiendo que quieras pedir 150.000‚Ç¨... pero el mercado dice 135.000‚Ç¨. Si salimos caros, ayudaremos a vender los pisos de tus vecinos. ¬øQuieres vender el tuyo o ayudar a los vecinos?"</em>
                        </div>

                        <h3>2. Filtro Financiero Compradores</h3>
                        <div class="alert-box">
                            <strong>üìû Las 3 Preguntas de Oro:</strong>
                            <ol class="list-decimal pl-4 text-sm mt-1">
                                <li><em>"¬øCompras al contado o necesitas financiaci√≥n?"</em></li>
                                <li><em>"Si es hipoteca: ¬øYa tienes pre-aprobaci√≥n bancaria?"</em></li>
                                <li><em>"¬øDispones del 30% de fondos propios?"</em></li>
                            </ol>
                        </div>

                        <h3>3. Calculadora de Cierre</h3>
                        <p>Utiliza esta calculadora para generar la <strong>Hoja de Liquidaci√≥n (Vendedor)</strong> o la <strong>Hoja de Costes (Comprador)</strong>.</p>
                    </div>

                    <!-- APP CALCULADORA COMPRAVENTA V2 -->
                    <div class="app-container" id="salesCalcApp">
                        <div class="app-header" onclick="toggleApp('salesAppContent', 'toggleSalesIcon')">
                            <div class="flex items-center">
                                <i class="fas fa-calculator text-white text-xl mr-3"></i>
                                <span class="text-lg font-bold text-white m-0 p-0">Calculadora de Cierre (Vendedor/Comprador)</span>
                            </div>
                            <i id="toggleSalesIcon" class="fas fa-chevron-down text-white transition-transform duration-300"></i>
                        </div>
                        
                        <div id="salesAppContent" class="app-content bg-slate-50 p-6">
                            
                            <!-- Pesta√±as -->
                            <div class="flex mb-4 border-b border-slate-300">
                                <button onclick="switchTab('seller')" id="btnSeller" class="px-4 py-2 font-bold text-blue-600 border-b-2 border-blue-600 bg-blue-50 focus:outline-none w-1/2">Para Vendedor (Neto)</button>
                                <button onclick="switchTab('buyer')" id="btnBuyer" class="px-4 py-2 font-bold text-slate-500 hover:text-blue-500 focus:outline-none w-1/2">Para Comprador (Gastos)</button>
                            </div>

                            <!-- PESTA√ëA VENDEDOR -->
                            <div id="tabSeller" class="block animate-fade-in">
                                <p class="text-xs text-slate-500 mb-4">Calcula el neto real para el propietario tras descontar todos los gastos.</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-3">
                                        <!-- Inputs -->
                                        <div><label class="calc-label">Precio Venta (‚Ç¨)</label><input type="number" id="s_price" class="calc-input font-bold text-blue-900 bg-white" oninput="calcSeller()" placeholder="0"></div>
                                        
                                        <div>
                                            <div class="flex items-center justify-between mb-1">
                                                <label class="calc-label">Hipoteca a cancelar (‚Ç¨)</label>
                                                <div class="flex items-center"><input type="checkbox" id="s_has_mortgage" class="mr-1" onchange="toggleSellerMortgage()"><label for="s_has_mortgage" class="text-xs text-slate-500 cursor-pointer">S√≠</label></div>
                                            </div>
                                            <input type="number" id="s_mortgage" class="calc-input text-red-700 disabled:bg-slate-100 disabled:text-slate-400" oninput="calcSeller()" placeholder="0" disabled>
                                        </div>

                                        <div><label class="calc-label">Plusval√≠a Municipal (‚Ç¨)</label><input type="number" id="s_plusvalia" class="calc-input text-red-700" oninput="calcSeller()" placeholder="0"></div>
                                        
                                        <!-- Honorarios Flexibles Vendedor -->
                                        <div class="bg-blue-50 p-2 rounded border border-blue-100">
                                            <label class="calc-label text-blue-800">Honorarios Rentia (+ IVA)</label>
                                            <div class="flex items-center mt-1 space-x-2">
                                                <select id="s_fee_type" onchange="calcSeller()" class="p-1 text-sm border rounded bg-white">
                                                    <option value="percent">%</option>
                                                    <option value="fixed">Fijo ‚Ç¨</option>
                                                </select>
                                                <input type="number" id="s_fee_value" class="calc-input w-24" oninput="calcSeller()" value="3">
                                                <input type="text" id="s_fee_total" class="calc-input bg-slate-100 text-red-700 text-xs font-bold" readonly>
                                            </div>
                                        </div>

                                        <div><label class="calc-label">Otros Gastos (‚Ç¨)</label><input type="number" id="s_other" class="calc-input text-red-700" oninput="calcSeller()" value="500"></div>
                                    </div>
                                    
                                    <!-- Resultados Vendedor -->
                                    <div class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm flex flex-col justify-between">
                                        <div>
                                            <h4 class="text-center text-slate-500 uppercase text-xs font-bold tracking-wider mb-2">DINERO NETO AL BOLSILLO</h4>
                                            <div class="text-center mb-6"><span class="text-4xl font-bold text-green-600" id="s_net_result">0 ‚Ç¨</span></div>
                                        </div>
                                        <button onclick="openPrintWindow('sales_seller')" class="w-full bg-slate-800 text-white py-2 rounded text-sm font-bold hover:bg-slate-900 transition"><i class="fas fa-print mr-2"></i> Imprimir Informe Cierre</button>
                                    </div>
                                </div>
                            </div>

                            <!-- PESTA√ëA COMPRADOR -->
                            <div id="tabBuyer" class="hidden animate-fade-in">
                                <p class="text-xs text-slate-500 mb-4">Desglose total de costes para evitar sorpresas en la firma.</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-3">
                                        <div><label class="calc-label">Precio Compra (‚Ç¨)</label><input type="number" id="b_price" class="calc-input font-bold text-blue-900 bg-white" oninput="calcBuyer()" placeholder="0"></div>
                                        
                                        <!-- Honorarios Flexibles Comprador -->
                                        <div class="bg-blue-50 p-2 rounded border border-blue-100">
                                            <label class="calc-label text-blue-800">Honorarios Agencia (+ IVA)</label>
                                            <div class="flex items-center mt-1 space-x-2">
                                                <select id="b_fee_type" onchange="calcBuyer()" class="p-1 text-sm border rounded bg-white">
                                                    <option value="percent">%</option>
                                                    <option value="fixed">Fijo ‚Ç¨</option>
                                                </select>
                                                <input type="number" id="b_fee_value" class="calc-input w-24" oninput="calcBuyer()" value="0" placeholder="0">
                                                <input type="text" id="b_fee_total" class="calc-input bg-slate-100 text-red-700 text-xs font-bold" readonly value="0 ‚Ç¨">
                                            </div>
                                        </div>

                                        <div><label class="calc-label">ITP (%)</label><input type="number" id="b_itp_percent" class="calc-input" oninput="calcBuyer()" value="8" placeholder="8"></div>
                                        
                                        <div class="grid grid-cols-2 gap-2">
                                            <div><label class="calc-label">Notar√≠a</label><input type="number" id="b_notary" class="calc-input" oninput="calcBuyer()" value="800"></div>
                                            <div><label class="calc-label">Registro</label><input type="number" id="b_registry" class="calc-input" oninput="calcBuyer()" value="400"></div>
                                        </div>
                                        
                                        <!-- Toggle Hipoteca Comprador -->
                                        <div class="bg-indigo-50 p-2 rounded border border-indigo-100">
                                            <div class="flex items-center mb-1">
                                                <input type="checkbox" id="b_needs_mortgage" class="mr-2 h-4 w-4" onchange="toggleBuyerMortgage()">
                                                <label for="b_needs_mortgage" class="text-xs font-bold text-indigo-900 cursor-pointer">¬øNecesita Hipoteca?</label>
                                            </div>
                                            <div id="mortgageFields" class="hidden grid grid-cols-2 gap-2 mt-1">
                                                <input type="number" id="b_appraisal" class="calc-input text-xs" oninput="calcBuyer()" value="350" placeholder="Tasaci√≥n">
                                                <input type="number" id="b_bank_fees" class="calc-input text-xs" oninput="calcBuyer()" value="0" placeholder="Comisi√≥n Banco">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Resultado Comprador -->
                                    <div class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm flex flex-col justify-between">
                                        <div class="mb-4 pb-4 border-b border-blue-200 text-sm space-y-2">
                                            <div class="flex justify-between"><span>Precio Inmueble:</span><span class="font-bold text-slate-800" id="b_res_price">0 ‚Ç¨</span></div>
                                            <div class="flex justify-between"><span>Honorarios Agencia:</span><span class="font-bold text-red-600" id="b_res_agency">0 ‚Ç¨</span></div>
                                            <div class="flex justify-between"><span>Impuestos (ITP):</span><span class="font-bold text-red-600">+ <span id="b_res_itp">0 ‚Ç¨</span></span></div>
                                            <div class="flex justify-between"><span>Gastos Not/Reg:</span><span class="font-bold text-red-600">+ <span id="b_res_expenses">0 ‚Ç¨</span></span></div>
                                            <div id="b_res_mortgage_row" class="hidden flex justify-between"><span>Gastos Hipoteca:</span><span class="font-bold text-red-600">+ <span id="b_res_mortgage_total">0</span> ‚Ç¨</span></div>
                                        </div>
                                        <div>
                                            <h4 class="text-center text-blue-800 uppercase text-xs font-bold tracking-wider mb-1">COSTE TOTAL REAL</h4>
                                            <div class="text-center mb-4"><span class="text-3xl font-bold text-blue-900" id="b_total_cost">0 ‚Ç¨</span></div>
                                            <button onclick="openPrintWindow('sales_buyer')" class="w-full bg-blue-800 text-white py-2 rounded text-sm font-bold hover:bg-blue-900 transition"><i class="fas fa-print mr-2"></i> Imprimir Hoja Costes</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        function toggleApp(contentId, iconId) {
            const content = document.getElementById(contentId);
            const icon = document.getElementById(iconId);
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                icon.style.transform = 'rotate(0deg)';
                setTimeout(() => { content.style.display = 'none'; }, 300);
            } else {
                content.style.display = 'block';
                setTimeout(() => { content.classList.add('open'); icon.style.transform = 'rotate(180deg)'; }, 10);
            }
        }

        // --- SALES CALCULATOR LOGIC ---
        function switchTab(tab) {
            document.getElementById('tabSeller').classList.add('hidden');
            document.getElementById('tabBuyer').classList.add('hidden');
            document.getElementById('btnSeller').className = 'px-4 py-2 font-bold text-slate-500 hover:text-blue-500 focus:outline-none w-1/2 border-b-2 border-transparent';
            document.getElementById('btnBuyer').className = 'px-4 py-2 font-bold text-slate-500 hover:text-blue-500 focus:outline-none w-1/2 border-b-2 border-transparent';

            if(tab === 'seller') {
                document.getElementById('tabSeller').classList.remove('hidden');
                document.getElementById('btnSeller').className = 'px-4 py-2 font-bold text-blue-600 border-b-2 border-blue-600 bg-blue-50 focus:outline-none w-1/2';
            } else {
                document.getElementById('tabBuyer').classList.remove('hidden');
                document.getElementById('btnBuyer').className = 'px-4 py-2 font-bold text-blue-600 border-b-2 border-blue-600 bg-blue-50 focus:outline-none w-1/2';
            }
        }

        function toggleSellerMortgage() {
            const checkbox = document.getElementById('s_has_mortgage');
            document.getElementById('s_mortgage').disabled = !checkbox.checked;
            if (!checkbox.checked) document.getElementById('s_mortgage').value = '';
            calcSeller();
        }

        function getFeeTotal(price, type, value) {
            let base = 0;
            if (type === 'percent') {
                base = price * (value / 100);
            } else {
                base = value;
            }
            return base * 1.21; // + 21% IVA
        }

        function calcSeller() {
            const price = parseFloat(document.getElementById('s_price').value) || 0;
            const mortgage = parseFloat(document.getElementById('s_mortgage').value) || 0;
            const plusvalia = parseFloat(document.getElementById('s_plusvalia').value) || 0;
            const other = parseFloat(document.getElementById('s_other').value) || 0;
            
            const feeType = document.getElementById('s_fee_type').value;
            const feeValue = parseFloat(document.getElementById('s_fee_value').value) || 0;
            const feeTotal = getFeeTotal(price, feeType, feeValue);

            document.getElementById('s_fee_total').value = feeTotal.toLocaleString('es-ES', { maximumFractionDigits: 0 }) + ' ‚Ç¨';
            const net = price - mortgage - plusvalia - feeTotal - other;
            document.getElementById('s_net_result').innerText = net.toLocaleString('es-ES', { maximumFractionDigits: 0 }) + ' ‚Ç¨';
        }

        function toggleBuyerMortgage() {
            const checkbox = document.getElementById('b_needs_mortgage');
            if(checkbox.checked) {
                document.getElementById('mortgageFields').classList.remove('hidden');
                document.getElementById('b_res_mortgage_row').classList.remove('hidden');
            } else {
                document.getElementById('mortgageFields').classList.add('hidden');
                document.getElementById('b_res_mortgage_row').classList.add('hidden');
            }
            calcBuyer();
        }

        function calcBuyer() {
            const price = parseFloat(document.getElementById('b_price').value) || 0;
            const itp = price * ((parseFloat(document.getElementById('b_itp_percent').value) || 0) / 100);
            const expenses = (parseFloat(document.getElementById('b_notary').value) || 0) + (parseFloat(document.getElementById('b_registry').value) || 0) + (parseFloat(document.getElementById('b_management').value) || 0);
            
            const feeType = document.getElementById('b_fee_type').value;
            const feeValue = parseFloat(document.getElementById('b_fee_value').value) || 0;
            const feeTotal = getFeeTotal(price, feeType, feeValue); 
            document.getElementById('b_fee_total').value = feeTotal.toLocaleString('es-ES', { maximumFractionDigits: 0 }) + ' ‚Ç¨';

            let mortgageCost = 0;
            if (document.getElementById('b_needs_mortgage').checked) {
                mortgageCost = (parseFloat(document.getElementById('b_appraisal').value) || 0) + (parseFloat(document.getElementById('b_bank_fees').value) || 0);
            }

            document.getElementById('b_res_price').innerText = price.toLocaleString('es-ES') + ' ‚Ç¨';
            document.getElementById('b_res_agency').innerText = '+ ' + feeTotal.toLocaleString('es-ES', { maximumFractionDigits: 0 }) + ' ‚Ç¨';
            document.getElementById('b_res_itp').innerText = '+ ' + itp.toLocaleString('es-ES', { maximumFractionDigits: 0 }) + ' ‚Ç¨';
            document.getElementById('b_res_expenses').innerText = '+ ' + expenses.toLocaleString('es-ES', { maximumFractionDigits: 0 }) + ' ‚Ç¨';
            document.getElementById('b_res_mortgage_total').innerText = '+ ' + mortgageCost.toLocaleString('es-ES', { maximumFractionDigits: 0 }) + ' ‚Ç¨';
            
            document.getElementById('b_total_cost').innerText = (price + itp + expenses + mortgageCost + feeTotal).toLocaleString('es-ES', { maximumFractionDigits: 0 }) + ' ‚Ç¨';
        }

        // --- RENT CALC LOGIC ---
        document.getElementById('numRooms').addEventListener('input', function() {
            const container = document.getElementById('roomPricesContainer');
            container.innerHTML = ''; 
            const count = parseInt(this.value) || 0;
            for(let i=1; i<=count; i++) {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-2 bg-blue-50 p-2 rounded';
                div.innerHTML = `<label class="text-xs font-bold text-blue-800 w-24">Hab ${i}:</label><input type="number" class="room-price-input w-full p-1 border border-blue-200 rounded text-sm text-right focus:border-blue-500 outline-none" placeholder="0"><span class="text-xs text-slate-500">‚Ç¨</span>`;
                container.appendChild(div);
            }
        });

        // --- NEW WINDOW PRINT SYSTEM (100% RELIABLE) ---
        function openPrintWindow(type) {
            let content = '';
            const today = new Date().toLocaleDateString('es-ES');
            
            if (type === 'checklist') {
                content = `
                <div style="font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto;">
                    <div style="display:flex; justify-content:space-between; border-bottom:3px solid #1e3a8a; padding-bottom:15px; margin-bottom:20px;">
                        <div><h1 style="color:#1e3a8a; font-size:24px; font-weight:bold; margin:0;">HOJA DE VISITA T√âCNICA</h1><p style="color:#64748b; font-size:12px; margin:0;">Rentia Investments S.L.</p></div>
                        <div style="text-align:right;"><div style="border:1px solid #cbd5e1; padding:5px 10px; display:inline-block; font-size:12px;">Fecha: _____/_____/_______</div></div>
                    </div>
                    <div style="margin-bottom:20px; font-size:14px;"><p style="margin-bottom:10px;"><strong>Direcci√≥n:</strong> __________________________________________________________________</p><p><strong>Propietario/Contacto:</strong> _________________________________________________________</p></div>
                    <h3 style="background:#f1f5f9; padding:8px 10px; color:#1e3a8a; border-left:4px solid #2563eb; margin-top:20px; font-size:14px; font-weight:bold; text-transform: uppercase;">1. Funcionalidad B√°sica</h3>
                    <div style="font-size:14px; line-height:2.5;">
                        <div style="border-bottom:1px dashed #cbd5e1;">‚ñ¢ Grifos (abren/cierran bien) _________________________</div>
                        <div style="border-bottom:1px dashed #cbd5e1;">‚ñ¢ Cisternas inodoros __________________________________</div>
                        <div style="border-bottom:1px dashed #cbd5e1;">‚ñ¢ Luces (encienden todas) _____________________________</div>
                        <div style="border-bottom:1px dashed #cbd5e1;">‚ñ¢ Manivelas puertas ___________________________________</div>
                        <div style="border-bottom:1px dashed #cbd5e1;">‚ñ¢ Ventanas/Persianas __________________________________</div>
                    </div>
                    <h3 style="background:#f1f5f9; padding:8px 10px; color:#1e3a8a; border-left:4px solid #2563eb; margin-top:20px; font-size:14px; font-weight:bold; text-transform: uppercase;">2. Estado Estructural</h3>
                    <div style="font-size:14px; line-height:2.5;">
                        <div style="border-bottom:1px dashed #cbd5e1;">‚ñ¢ Humedades (Techos/Esquinas) _________________________</div>
                        <div style="border-bottom:1px dashed #cbd5e1;">‚ñ¢ Grietas visibles ____________________________________</div>
                        <div style="border-bottom:1px dashed #cbd5e1;">‚ñ¢ Estado Suelo ________________________________________</div>
                    </div>
                    <h3 style="background:#f1f5f9; padding:8px 10px; color:#1e3a8a; border-left:4px solid #2563eb; margin-top:20px; font-size:14px; font-weight:bold; text-transform: uppercase;">4. Croquis / Notas</h3>
                    <div style="border:1px solid #cbd5e1; height:300px; margin-top:10px;"></div>
                </div>`;
            } 
            else if (type === 'rental_study') {
                // Recopilar datos alquiler
                let roomHtml = '';
                let totalGross = 0;
                document.querySelectorAll('.room-price-input').forEach((input, index) => {
                    const val = parseFloat(input.value) || 0;
                    totalGross += val;
                    roomHtml += `<li style="display:flex; justify-content:space-between; border-bottom:1px solid #f1f5f9; padding:5px 0;"><span>Habitaci√≥n ${index + 1}</span> <strong>${val} ‚Ç¨</strong></li>`;
                });
                const feePercent = parseFloat(document.getElementById('feePercent').value) || 0;
                const discountPercent = parseFloat(document.getElementById('discountPercent').value) || 0;
                let baseFee = totalGross * (feePercent / 100);
                let finalFee = baseFee * (1 - (discountPercent / 100));
                let iva = finalFee * 0.21;
                let net = totalGross - finalFee - iva;
                let cleaning = parseFloat(document.getElementById('cleaningCost').value) || 0;

                content = `
                <div style="padding:40px; font-family:'Arial'; color:black; max-width:800px; margin:0 auto;">
                    <div style="display:flex; justify-content:space-between; border-bottom:2px solid #1e3a8a; padding-bottom:15px; margin-bottom:25px;">
                        <div><h4 style="color:#1e3a8a; font-size:24px; font-weight:bold; margin:0;">RENTIA INVESTMENTS S.L.</h4><p style="font-size:12px; color:#64748b;">Gesti√≥n Integral de Activos</p></div>
                        <div style="text-align:right;"><div style="background:#dbeafe; color:#1e40af; padding:5px 10px; border-radius:4px; font-size:12px; font-weight:bold;">ESTUDIO RENTABILIDAD</div><p style="font-size:12px; color:#64748b;">${today}</p></div>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                        <div><p style="font-size:10px; color:#64748b; font-weight:bold; text-transform:uppercase;">PROPIEDAD</p><p style="font-size:16px; font-weight:bold;">${document.getElementById('propAddress').value || '-'}</p><p style="font-size:12px;">${document.getElementById('ownerName').value || '-'}</p></div>
                        <div style="text-align:right;"><p style="font-size:10px; color:#64748b; font-weight:bold; text-transform:uppercase;">ESTRATEGIA</p><p style="font-size:12px;">Perfil: ${document.getElementById('targetProfile').value}</p><p style="font-size:12px;">Plazo: ${document.getElementById('estimatedTime').value}</p></div>
                    </div>
                    <div style="background:#f8fafc; padding:20px; border:1px solid #e2e8f0; border-radius:8px; margin-bottom:20px;">
                        <h5 style="color:#1e3a8a; font-weight:bold; border-bottom:1px solid #cbd5e1; padding-bottom:10px; margin-bottom:15px;">INGRESOS ESTIMADOS</h5>
                        <ul style="list-style:none; padding:0; margin:0;">${roomHtml}</ul>
                        <div style="display:flex; justify-content:space-between; margin-top:15px; padding-top:15px; border-top:2px solid #cbd5e1;"><span style="font-weight:bold;">TOTAL BRUTO</span><span style="font-size:20px; font-weight:bold; color:#1e3a8a;">${totalGross} ‚Ç¨</span></div>
                    </div>
                    <div style="background:#f0fdf4; padding:20px; border:1px solid #bbf7d0; border-radius:8px; margin-bottom:20px;">
                        <h5 style="color:#166534; font-weight:bold; border-bottom:1px solid #86efac; padding-bottom:10px; margin-bottom:15px;">NETO PROPIETARIO</h5>
                        <div style="font-size:12px; color:#475569; margin-bottom:10px;">
                            <div style="display:flex; justify-content:space-between;"><span>(-) Honorarios (${feePercent}%) ${discountPercent > 0 ? 'DTO' : ''}</span> <span>-${finalFee.toFixed(2)} ‚Ç¨</span></div>
                            <div style="display:flex; justify-content:space-between;"><span>(-) IVA (21%)</span> <span>-${iva.toFixed(2)} ‚Ç¨</span></div>
                            <div style="display:flex; justify-content:space-between; font-style:italic; margin-top:5px; border-top:1px dashed #cbd5e1; padding-top:5px;"><span>(i) Coste Limpieza Aprox.</span> <span>${cleaning} ‚Ç¨</span></div>
                        </div>
                        <div style="display:flex; justify-content:space-between; padding-top:10px; border-top:1px solid #15803d;"><span style="font-weight:bold; color:#14532d;">INGRESO NETO ESTIMADO</span><span style="font-size:24px; font-weight:bold; color:#15803d;">${net.toFixed(2)} ‚Ç¨</span></div>
                    </div>
                </div>`;
            }
            else if (type === 'sales_seller') {
                 const price = document.getElementById('s_price').value || 0;
                 const net = document.getElementById('s_net_result').innerText;
                 const feeTotal = document.getElementById('s_fee_total').value;
                 const mortgage = document.getElementById('s_mortgage').value || 0;
                 content = `
                    <div style="padding:40px; font-family:'Arial'; color:black; max-width:800px; margin:0 auto;">
                        <div style="display:flex; justify-content:space-between; border-bottom:3px solid #1e3a8a; padding-bottom:15px; margin-bottom:30px;">
                            <div><h1 style="color:#1e3a8a; font-size:22px; font-weight:bold; margin:0;">HOJA DE VALORACI√ìN</h1><p style="color:#64748b; font-size:12px; margin:0;">Rentia Investments S.L.</p></div>
                            <div style="text-align:right;"><div style="background:#dcfce7; color:#166534; padding:5px 15px; border-radius:4px; font-weight:bold; font-size:12px;">LIQUIDACI√ìN VENDEDOR</div></div>
                        </div>
                        <div style="font-size:16px; margin-bottom:20px;"><p><strong>Precio de Venta Acordado:</strong> <span style="font-size:20px;">${parseFloat(price).toLocaleString('es-ES')} ‚Ç¨</span></p></div>
                        <table style="width:100%; border-collapse:collapse; font-size:14px;">
                            <tr style="background:#f8fafc; border-bottom:1px solid #cbd5e1;"><td style="padding:10px;">(-) Hipoteca Pendiente</td><td style="text-align:right;">- ${parseFloat(mortgage).toLocaleString('es-ES')} ‚Ç¨</td></tr>
                            <tr style="border-bottom:1px solid #cbd5e1;"><td style="padding:10px;">(-) Honorarios Agencia (IVA inc.)</td><td style="text-align:right;">- ${feeTotal}</td></tr>
                            <tr style="border-bottom:1px solid #cbd5e1;"><td style="padding:10px;">(-) Plusval√≠a / Otros</td><td style="text-align:right;">- ${parseFloat(document.getElementById('s_plusvalia').value || 0).toLocaleString('es-ES')} ‚Ç¨</td></tr>
                            <tr style="background:#f0fdf4; color:#15803d; font-weight:bold; font-size:18px;"><td style="padding:15px;">TOTAL NETO A PERCIBIR</td><td style="text-align:right;">${net}</td></tr>
                        </table>
                    </div>`;
            }
            else if (type === 'sales_buyer') {
                const total = document.getElementById('b_total_cost').innerText;
                const price = document.getElementById('b_price').value || 0;
                const fee = document.getElementById('b_fee_total').value;
                content = `
                    <div style="padding:40px; font-family:'Arial'; color:black; max-width:800px; margin:0 auto;">
                        <div style="display:flex; justify-content:space-between; border-bottom:3px solid #1e3a8a; padding-bottom:15px; margin-bottom:30px;">
                            <div><h1 style="color:#1e3a8a; font-size:22px; font-weight:bold; margin:0;">HOJA DE VALORACI√ìN</h1><p style="color:#64748b; font-size:12px; margin:0;">Rentia Investments S.L.</p></div>
                            <div style="text-align:right;"><div style="background:#dbeafe; color:#1e40af; padding:5px 15px; border-radius:4px; font-weight:bold; font-size:12px;">COSTE ADQUISICI√ìN</div></div>
                        </div>
                        <div style="font-size:16px; margin-bottom:20px;"><p><strong>Precio de Compra Inmueble:</strong> <span style="font-size:20px;">${parseFloat(price).toLocaleString('es-ES')} ‚Ç¨</span></p></div>
                        <table style="width:100%; border-collapse:collapse; font-size:14px;">
                            <tr style="border-bottom:1px solid #cbd5e1;"><td style="padding:10px;">(+) Impuestos (ITP)</td><td style="text-align:right;">${document.getElementById('b_res_itp').innerText}</td></tr>
                            <tr style="border-bottom:1px solid #cbd5e1;"><td style="padding:10px;">(+) Honorarios Agencia</td><td style="text-align:right;">${fee}</td></tr>
                            <tr style="border-bottom:1px solid #cbd5e1;"><td style="padding:10px;">(+) Notar√≠a / Registro / Gestor√≠a</td><td style="text-align:right;">${document.getElementById('b_res_expenses').innerText}</td></tr>
                            <tr style="background:#eff6ff; color:#1e3a8a; font-weight:bold; font-size:18px;"><td style="padding:15px;">COSTE TOTAL OPERACI√ìN</td><td style="text-align:right;">${total}</td></tr>
                        </table>
                    </div>`;
            }

            // OPEN NEW WINDOW AND PRINT
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>Imprimir</title></head><body style="margin:0; padding:0;">');
            printWindow.document.write(content);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            
            // Esperar a que cargue el contenido antes de imprimir
            setTimeout(() => {
                printWindow.focus();
                printWindow.print();
                // printWindow.close(); // Opcional: cerrar despu√©s de imprimir
            }, 500);
        }
    </script>

</body>
</html>
